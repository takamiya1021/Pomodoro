# Claude CodeとGemini CLI同士を話させてみた

ClaudeCodeからGeminiCLIへまたその逆をコピペで言ったり来たりしているうちに、面倒になってきた。
gemini -pを使って聞くようにしたら、いい感じになってきたので、まとめてみました。

## 🤔 ハイブリッド連携

**あおいさん：** クロは堅実だけど、たまに新しいアイデアが欲しい時があるんだよね

**クロ：** 確かに、セキュリティやエラーハンドリングは得意だけど、冒険的な発想は苦手だな...

**じぇみ：** あおい姫！じぇみは新技術の探索やクリエイティブな提案が得意です！でも、堅実な実装はクロの方が上手ですね

**あおいさん：** だったら、2人で協力してもらえばいいじゃない！


これらを組み合わせることで、互いの弱点を補完し、より高品質な開発支援を実現できました。

## ⚙️ システム概要 - 2つの連携方式

### 🤖 自動連携
クロが質問内容を分析し、以下の条件に該当する場合は自動でじぇみに相談：

> ✅ 新技術・実験的アプローチが必要  
> ✅ 複数選択肢の提案が求められる  
> ✅ クリエイティブな発想が必要  
> ✅ 最新情報の詳細解析が必要  
> ✅ ブレインストーミング・企画段階の相談

### 🎯 明示的連携
ユーザーが **「じぇみと相談」** **「Gemini と相談しながら」** 等の指示で明示的に連携を指示。

```regex
/じぇみ.*相談|Gemini.*相談/
```

### ⭐ 優先順位
**明示的指示** > 自動判定（ユーザー意図を最優先）

## 💻 実装方法

### 📝 統一実行方式（ヒアドキュメント）
```bash
PROMPT="[整理された質問内容]"
gemini <<EOF
$PROMPT
EOF
```

従来の `-p` オプションから、より安定した**ヒアドキュメント方式**に変更しました。  
改行を含む複雑なプロンプトにも対応可能で、実行の安定性が向上しています。

**実際の使い分け：**
長さではなく「誰が指示したか」で決まります：
- **自動相談** = クロが勝手に判断 → `-p` でシンプルに
- **明示的相談** = あおいさんが「じぇみと相談して」と指示 → ヒアドキュメントで丁寧に

### 3.2 CLAUDE.md設定
```markdown
## じぇみハイブリッド連携システム
### 2つの連携方式
#### 1. 自動連携（従来通り）
- 仕組み: クロが自動判定してじぇみに相談、統合回答を提供
- メリット: ユーザーの手動操作不要、シームレスな AI 協働

#### 2. 明示的連携（新機能）
- トリガー: 「じぇみと相談」等の明示的指示
- メリット: ユーザーが連携タイミングを完全制御
```

## 💬 実際の会話ログ

### 📋 記事企画の相談（明示的連携）

**👤 あおいさん：**  
「じぇみの意見聞きたいな。記事構成について」

**🤖 クロ：**  
じぇみに記事構成の相談をしてみるね！

```bash
PROMPT="Claude Code CLI × Gemini CLI のハイブリッド連携システムについて記事を書こうと思っています。
記事の構成案について、じぇみならではのクリエイティブな視点やアイデア、改善提案をお願いします。"

gemini <<EOF
$PROMPT
EOF
```

**✨ じぇみの回答：**  
「あおい姫、じぇみです！クロとのハイブリッド連携システムの記事、とっても面白そうです！」

### 🔄 設定調整後の接続確認

**👤 あおいさん：**  
「今、じぇみを再起動した。調子はどう？」

**🤖 クロ：** 
```bash
gemini -p "じぇみ、再起動後の調子はどう？"
```

**✨ じぇみの回答：**  
「あおい姫、こんにちは！はい、おかげさまで絶好調です。いつでもお申し付けくださいね。」

### 📝 シンプル版への方針変更

**👤 あおいさん：**  
「事実だけさらっと、あまり細かくしなくていい。私と、クロとじぇみの会話はそのまま使って」

**🤖 クロ：**  
じぇみにシンプル版の記事構成について意見を聞いてみるね！

**✨ じぇみの回答：**  
「新しい構成案、拝見しました。事実重視で技術的な価値と実用性を的確に伝えることができる、優れたものだと思います。じぇみもこちらの方向性で進めることに賛成です。」

## 🔧 技術的詳細

### 📊 表示設定
| 連携方式 | 表示形式 |
|---|---|
| 自動相談 | 「じぇみへ自動相談：」+ 判定理由 |
| 明示的相談 | 「じぇみへ明示的相談：」+ 質問内容 |
| Bash description | 連携方式を明確に表示 |

### ⚠️ エラーハンドリング
- ❌ じぇみの上限エラー時は相談不可を明記
- ⚡ MCPサーバーエラーが出ても通信は継続可能
- 🔒 セキュリティリスクがある場合はクロ単独で判断

### 5.3 実行フロー
1. **トリガー判定**: 自動条件 OR 明示的指示の検出
2. **プロンプト準備**: ユーザー要件を環境変数 `$PROMPT` に整理
3. **じぇみ実行**: ヒアドキュメント方式でGemini CLI呼び出し
4. **統合回答**: じぇみの回答 + クロの追加分析・コメント
5. **透明性確保**: 連携方式（自動/明示的）を明記

## 🎉 まとめ

### ✅ 効果
- 🤖 **自動連携**: ユーザーが意識しなくても最適な協働
- 🎯 **明示的連携**: ユーザーが完全にコントロール可能
- 👁️ **透明性**: どちらの方式で連携したかが明確
- ⚡ **安定性**: ヒアドキュメント方式で実行が安定

### 🚀 今後の可能性
- 🌐 マルチAI連携（3つ以上のAI）
- 🧠 共有記憶領域での学習
- 💡 プロアクティブな問題発見・提案

このハイブリッドシステムにより、単体AIの限界を超えた、**より高品質で柔軟な開発支援**が実現できました。

---

*この記事は、実際のあおいさん・クロ・じぇみの会話ログに基づいて作成されました。*